<view class="container">
  <image class="bg" src="/assets/bg.jpg" mode="aspectFill" />
  <view class="bg-overlay"></view>

  <view class="content">
    <!-- ç§¯åˆ†å±•ç¤º -->
    <!-- ç§¯åˆ†å±•ç¤º -->
    <view class="points-card">
    <text class="label">ğŸ¯ {{ username }}çš„ç§¯åˆ†ï¼š</text>
    <text class="points">{{ memberPoints }}</text>
  </view>


    <!-- è€è™æœºæŠ½å¥–åŒºåŸŸ -->
    <view class="lottery-section">
  <text class="title">ğŸ° 10ç§¯åˆ†æŠ½å¥½ç¤¼ï¼ï¼(æµ·é‡ä¼˜æƒ åˆ¸ç­‰ä½ æ¥æ‹¿ï¼‰ï¼</text>

  <view class="slot-machine">
    <image class="slot-frame" src="/assets/slot-frame.png" mode="aspectFit" />
    <view class="slot-reels">
      <image class="reel" src="{{ reels[0] }}" mode="aspectFit" />
      <image class="reel" src="{{ reels[1] }}" mode="aspectFit" />
      <image class="reel" src="{{ reels[2] }}" mode="aspectFit" />
    </view>
  </view>

  <button class="draw-btn" bindtap="drawLottery" disabled="{{spinning}}">
    {{ spinning ? 'æŠ½å¥–ä¸­...' : 'ç‚¹å‡»æŠ½å¥–' }}
  </button>
</view>
    <!-- æŠ½å¥–ç»“æœå¼¹çª— -->
    <view wx:if="{{ showResult }}" class="result-popup">
      <view class="popup-content">
        <text class="prize">{{ lotteryResult }}</text>
        <button class="close-btn" bindtap="closeResult">å…³é—­</button>
      </view>
    </view>
  </view>
  <!-- åˆ‡æ¢æŒ‰é’® -->
<view class="tab-switch">
  <button 
    class="{{ !showExpired ? 'active' : '' }}" 
    bindtap="toggleCouponView"
  >æœ‰æ•ˆä¼˜æƒ åˆ¸</button>
  <button 
    class="{{ showExpired ? 'active' : '' }}" 
    bindtap="toggleCouponView"
  >å·²è¿‡æœŸä¼˜æƒ åˆ¸</button>
</view>

<!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
<view class="coupon-list">
  <block wx:if="{{ !showExpired }}">
    <block wx:for="{{ couponsValid }}" wx:key="coupon_id">
      <view class="coupon-card">
        <text class="coupon-amount">ğŸ’° æ»¡{{ item.min_threshold }}å‡{{ item.discount_amount }}</text>
        <text class="coupon-dates">ğŸ•’ æœ‰æ•ˆæœŸï¼š{{ item.start_date }} ~ {{ item.expiry_date }}</text>
      </view>
    </block>
    <view wx:if="{{ couponsValid.length === 0 }}">æš‚æ— æœ‰æ•ˆä¼˜æƒ åˆ¸</view>
  </block>

  <block wx:if="{{ showExpired }}">
    <block wx:for="{{ couponsExpired }}" wx:key="coupon_id">
      <view class="coupon-card expired">
        <text class="coupon-amount">ğŸ’° æ»¡{{ item.min_threshold }}å‡{{ item.discount_amount }}</text>
        <text class="coupon-dates">
          ğŸ•’ æœ‰æ•ˆæœŸï¼š{{ item.start_date }} ~ {{ item.expiry_date }}
          <text class="expired-label">ï¼ˆå·²è¿‡æœŸï¼‰</text>
        </text>
      </view>
    </block>
    <view wx:if="{{ couponsExpired.length === 0 }}">æš‚æ— å·²è¿‡æœŸä¼˜æƒ åˆ¸</view>
  </block>
</view>
</view>
